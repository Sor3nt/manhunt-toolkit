<?php
namespace App\Tests\CompilerV2\Memory;

use App\MHT;
use PHPUnit\Framework\TestCase;

class StringMemoryMh1Test extends TestCase
{

    public function test()
    {


        $script = "
SCRIPTMAIN	HunterScripts;

ENTITY
	Guard05		:	et_name;


VAR

SCRIPT OnCreate;
BEGIN
	
	SetHunterHideHealth(getEntityName(this),0);		
		
	AISetEntityIdleOverRide('Guard05',TRUE,TRUE);
	SetPedLockonable(this,FALSE);
	AISetHunterOnRadar(GetEntityName(this),FALSE);
	AISetEntityAllowSurprise(GetEntityName(this),FALSE);		
End;

SCRIPT GetPath;
BEGIN
	SetPedLockonable(this,TRUE);		
	AISetIdleHomeNode('Guard05','Piggsy_Home5');
	AISetHunterIdleActionMinMaxRadius('Guard05',AISCRIPT_IDLE_WANDERSEARCH,AISCRIPT_VERYHIGHPRIORITY,1000,10000,60.0);	
	AIEntityGoHomeIfIdle('Guard05');
	
	removethisscript;
	
End;

SCRIPT onHunterIdle;
Begin
	AIEntityGoHomeIfIdle(GetEntityName(this));
End;


SCRIPT OnMediumHearingOrAbove;
BEGIN

	if IsEntityAlive(GetEntityName(this))
		then if AIIsEntityGuard(GetEntityName(this)) then
			begin
				RunScript('Attic','ChangingOfTheGuard');
			end;

End;


END. {end of Scripts}
";

        $expected = [
            "10000000",
            "0a000000",
            "11000000",
            "0a000000",
            "09000000",
            "12000000",
            "01000000",
            "49000000",
            "10000000",
            "01000000",
            "85000000",
            "12000000",
            "01000000",
            "00000000",
            "10000000",
            "01000000",
            "ed010000",
            "21000000",
            "04000000",
            "01000000",
            "00000000",
            "12000000",
            "02000000",
            "08000000",
            "10000000",
            "01000000",
            "10000000",
            "02000000",
            "12000000",
            "01000000",
            "01000000",
            "10000000",
            "01000000",
            "12000000",
            "01000000",
            "01000000",
            "10000000",
            "01000000",
            "b4010000",
            "12000000",
            "01000000",
            "49000000",
            "10000000",
            "01000000",
            "12000000",
            "01000000",
            "00000000",
            "10000000",
            "01000000",
            "94020000",
            "12000000",
            "01000000",
            "49000000",
            "10000000",
            "01000000",
            "85000000",
            "12000000",
            "01000000",
            "00000000",
            "10000000",
            "01000000",
            "a7010000",
            "12000000",
            "01000000",
            "49000000",
            "10000000",
            "01000000",
            "85000000",
            "12000000",
            "01000000",
            "00000000",
            "10000000",
            "01000000",
            "6b020000",
            "11000000",
            "09000000",
            "0a000000",
            "0f000000",
            "0a000000",
            "3b000000",
            "00000000",
            "10000000",
            "0a000000",
            "11000000",
            "0a000000",
            "09000000",
            "12000000",
            "01000000",
            "49000000",
            "10000000",
            "01000000",
            "12000000",
            "01000000",
            "01000000",
            "10000000",
            "01000000",
            "94020000",
            "21000000",
            "04000000",
            "01000000",
            "08000000",
            "12000000",
            "02000000",
            "08000000",
            "10000000",
            "01000000",
            "10000000",
            "02000000",
            "21000000",
            "04000000",
            "01000000",
            "10000000",
            "12000000",
            "02000000",
            "10000000",
            "10000000",
            "01000000",
            "10000000",
            "02000000",
            "82010000",
            "21000000",
            "04000000",
            "01000000",
            "08000000",
            "12000000",
            "02000000",
            "08000000",
            "10000000",
            "01000000",
            "10000000",
            "02000000",
            "12000000",
            "01000000",
            "00000000",
            "10000000",
            "01000000",
            "12000000",
            "01000000",
            "00000000",
            "10000000",
            "01000000",
            "12000000",
            "01000000",
            "e8030000",
            "10000000",
            "01000000",
            "12000000",
            "01000000",
            "10270000",
            "10000000",
            "01000000",
            "12000000",
            "01000000",
            "00007042",
            "10000000",
            "01000000",
            "a3010000",
            "21000000",
            "04000000",
            "01000000",
            "08000000",
            "12000000",
            "02000000",
            "08000000",
            "10000000",
            "01000000",
            "10000000",
            "02000000",
            "15020000",
            "e7000000",
            "11000000",
            "09000000",
            "0a000000",
            "0f000000",
            "0a000000",
            "3b000000",
            "00000000",
            "10000000",
            "0a000000",
            "11000000",
            "0a000000",
            "09000000",
            "12000000",
            "01000000",
            "49000000",
            "10000000",
            "01000000",
            "85000000",
            "15020000",
            "11000000",
            "09000000",
            "0a000000",
            "0f000000",
            "0a000000",
            "3b000000",
            "00000000",
            "10000000",
            "0a000000",
            "11000000",
            "0a000000",
            "09000000",
            "12000000",
            "01000000",
            "49000000",
            "10000000",
            "01000000",
            "85000000",
            "a9010000",
            "24000000",
            "01000000",
            "00000000",
            "3f000000",
            "e0030000",
            "12000000",
            "01000000",
            "49000000",
            "10000000",
            "01000000",
            "85000000",
            "6c020000",
            "24000000",
            "01000000",
            "00000000",
            "3f000000",
            "e0030000",
            "21000000",
            "04000000",
            "01000000",
            "20000000",
            "12000000",
            "02000000",
            "08000000",
            "10000000",
            "01000000",
            "10000000",
            "02000000",
            "21000000",
            "04000000",
            "01000000",
            "28000000",
            "12000000",
            "02000000",
            "14000000",
            "10000000",
            "01000000",
            "10000000",
            "02000000",
            "e3000000",
            "11000000",
            "09000000",
            "0a000000",
            "0f000000",
            "0a000000",
            "3b000000",
            "00000000"
        ];

        $compiler = new \App\Service\CompilerV2\Compiler($script, MHT::GAME_MANHUNT, MHT::PLATFORM_PC);
        $compiled = $compiler->compile();

        if ($compiler->validateCode($expected) === false){

            foreach ($compiler->codes as $index => $newCode) {

                if ($expected[$index] == $newCode['code']){
                    echo $newCode['code'] . ' -> ' . $newCode['msg'] . "\n";

                }else{
                    echo "MISMATCH: Need: " . $expected[$index] . ' Got: ' . $newCode['code'] . ' -> ' . $newCode['msg']. "\n";

                }
            }
        }else{
            $this->assertEquals(true,true);
        }
    }

}